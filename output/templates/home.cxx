#include "config.hpp"
#include "home.hxx"

#include <sstream>

using std::string;

std::string Templates::home::render() {
	std::stringstream _output;
	
#line 1 "home.ct"
;	_output << "<!doctype html>\n"
		<< "\n"
		<< "\n"
		<< " \n"
		<< "<html>\n"
		<< "\n"
		<< "<head>\n"
		<< "	<link href=\"http://fonts.googleapis.com/css?family=Roboto:400,300italic,300,100italic,100,400italic,500\" rel=\"stylesheet\" type=\"text/css\">\n"
		<< "	<link rel=\"stylesheet\" type=\"text/css\" href=\"/css/main.css\">\n"
		<< "	<script type=\"text/javascript\" src=\"/js/stats.js\" defer></script>\n"
		<< "	<title>";  { std::stringstream _tmp; _tmp << POOL_NAME; _output << Template::HTML_escape( _tmp.str() ); } ;	_output << "</title>\n"
		<< "</head>\n"
		<< "\n"
		<< "<body>\n"
		<< "	<div id=\"pool-info\" class=\"container\">\n"
		<< "		<div id=\"pool-name\">";  { std::stringstream _tmp; _tmp << POOL_NAME; _output << Template::HTML_escape( _tmp.str() ); } ;	_output << "</div>\n"
		<< "\n"
		<< "		<a href=\"http://explorer.burstnation.com/address/";  { std::stringstream _tmp; _tmp << OUR_ACCOUNT_ID; _output << Template::URL_escape( _tmp.str() ); } ;	_output << "\" target=\"_blank\" class=\"blockex-link\">";  { std::stringstream _tmp; _tmp << OUR_ACCOUNT_RS; _output << Template::HTML_escape( _tmp.str() ); } ;	_output << "</a>\n"
		<< "		Assigned miners: <span id=\"num-assigned-miners\"></span>\n"
		<< "		Active miners: <span id=\"num-active-miners\"></span>\n"
		<< "	</div>\n"
		<< "\n"
		<< "\n"
		<< "	<div id=\"info\" class=\"auto\">\n"
		<< "		<div id=\"current-block-info\" class=\"container\">\n"
		<< "			<canvas id=\"timer\"></canvas>\n"
		<< "	\n"
		<< "			<div id=\"current-block-height\"></div>\n"
		<< "			<div id=\"current-block-scoop\"></div>\n"
		<< "		</div>\n"
		<< "		\n"
		<< "		<div id=\"current-awards\" class=\"container\">\n"
		<< "			<table id=\"current-awards-table\" class=\"awards-table\">\n"
		<< "				<caption>Current Block Metrics</caption>\n"
		<< "				<tbody id=\"current-awards-list\"></tbody>\n"
		<< "			</table>\n"
		<< "		</div>\n"
		<< "	\n"
		<< "	\n"
		<< "		<div id=\"previous-awards\" class=\"container\">\n"
		<< "			<table id=\"previous-awards-table\" class=\"awards-table\">\n"
		<< "				<caption>Previous Block Metrics</caption>\n"
		<< "				<tbody id=\"previous-awards-list\"></tbody>\n"
		<< "			</table>\n"
		<< "		</div>\n"
		<< "	</div>\n"
		<< "\n"
		<< "	\n"
		<< "	<div id=\"multi-tab-info\" class=\"container\">\n"
		<< "		<ul class=\"tabs\" id=\"tabs\">\n"
		<< "			<li tab-id=\"current-shares\" tab=\"active\">Current Block Shares</li>\n"
		<< "			<li tab-id=\"recent-blocks\">Recent Blocks</li>\n"
		<< "			<li tab-id=\"historic-shares\">Historic Blocks Shares</li>\n"
		<< "			<li tab-id=\"pool-help\">Pool Info</li>\n"
		<< "		</ul>\n"
		<< "	\n"
		<< "		<div id=\"current-shares\" class=\"tab\" tab=\"active\">\n"
		<< "			<div id=\"current-shares-graph\">\n"
		<< "				<canvas id=\"current-shares-chart\"></canvas>\n"
		<< "			</div>\n"
		<< "			\n"
		<< "			<div id=\"current-shares-info\">\n"
		<< "				<table id=\"current-shares-table\" class=\"shares-table\">\n"
		<< "					<caption>Current Block Shares (";  _output << CURRENT_BLOCK_REWARD_PERCENT; ;	_output << "% of block reward)</caption>\n"
		<< "					<thead>\n"
		<< "						<tr>\n"
		<< "							<th>Account</th>\n"
		<< "							<th>Miner</th>\n"
		<< "							<th>Deadline</th>\n"
		<< "							<th>Share</th>\n"
		<< "							<th>Reward</th>\n"
		<< "						</tr>\n"
		<< "					</thead>\n"
		<< "					<tbody id=\"current-shares-list\"></tbody>\n"
		<< "				</table>\n"
		<< "			</div>\n"
		<< "		</div>\n"
		<< "			\n"
		<< "		<div id=\"recent-blocks\" class=\"tab\">\n"
		<< "			<table id=\"recent-blocks-table\">\n"
		<< "				<caption>Recent Blocks</caption>\n"
		<< "				<thead>\n"
		<< "					<tr>\n"
		<< "						<th>Block</th>\n"
		<< "						<th>Forged By</th>\n"
		<< "						<th>Our Best Miner</th>\n"
		<< "					</tr>\n"
		<< "				</thead>\n"
		<< "				<tbody id=\"recent-blocks-list\"></tbody>\n"
		<< "			</table>\n"
		<< "		</div>\n"
		<< "		\n"
		<< "		<div id=\"historic-shares\" class=\"tab\">\n"
		<< "			<div id=\"historic-shares-graph\">\n"
		<< "				<canvas id=\"historic-shares-chart\"></canvas>\n"
		<< "			</div>\n"
		<< "			\n"
		<< "			<div id=\"historic-shares-info\">\n"
		<< "				<table id=\"historic-shares-table\" class=\"shares-table\">\n"
		<< "					<caption>Historic Blocks (";  _output << HISTORIC_BLOCK_COUNT; ;	_output << ") Shares  (";  _output << 100 - CURRENT_BLOCK_REWARD_PERCENT; ;	_output << "% of block reward)</caption>\n"
		<< "					<thead>\n"
		<< "						<tr>\n"
		<< "							<th>Account</th>\n"
		<< "							<th>Capacity</th>\n"
		<< "							<th>Share</th>\n"
		<< "							<th>Reward</th>\n"
		<< "							<th>Payouts</th>\n"
		<< "						</tr>\n"
		<< "					</thead>\n"
		<< "					<tbody id=\"historic-shares-list\"></tbody>\n"
		<< "				</table>\n"
		<< "			</div>\n"
		<< "		</div>\n"
		<< "		\n"
		<< "		<div id=\"pool-help\" class=\"tab\">\n"
		<< "			<h1>Pool Information</h1>\n"
		<< "			<ul>\n"
		<< "				<li>\n"
		<< "					Our maximum deadline is <config>";  _output << DEADLINE_MAX; ;	_output << " seconds</config>, submissions with deadlines higher than this will be discarded with error codes 1007 or 1008.<br>\n"
		<< "					You might be able to set your miner to explicitly skip nonces with deadlines above this threshold.<br>\n"
		<< "					Some miners automatically make use of the <code>targetDeadline</code> field when communicating with the pool.\n"
		<< "				</li>\n"
		<< "				<li>\n"
		<< "					Miners should submit nonces to <config>port ";  _output << LISTEN_PORT; ;	_output << "</config>.<br>\n"
		<< "					This pool also supports the <code>getMiningInfo</code> API call on the same port, with added <code>targetDeadline</code> field.<br>\n"
		<< "				</li>\n"
		<< "				<li>\n"
		<< "					To mine here you need to set your \"reward recipient\" to <config>";  { std::stringstream _tmp; _tmp << OUR_ACCOUNT_RS; _output << Template::HTML_escape( _tmp.str() ); } ;	_output << "</config>.<br>\n"
		<< "					This costs 1 BURST and you need to wait 4 blocks before it takes effect.\n"
		<< "				</li>\n"
		<< "				<li>\n"
		<< "					Your miner colour is (currently) determined by your numeric account ID.\n"
		<< "				</li>\n"
		<< "				<li>\n"
		<< "					When the pool wins a block, <config>";  _output << POOL_FEE_FRACTION * 100; ;	_output << "%</config> is deducted from the block reward for pool usage fees.<br>\n"
		<< "					Of the remaining reward, <config>";  _output << CURRENT_BLOCK_REWARD_PERCENT; ;	_output << "%</config> is shared over miners who submitted nonces for the current block.<br>\n"
		<< "					The other <config>";  _output << 100 - CURRENT_BLOCK_REWARD_PERCENT; ;	_output << "%</config> is shared over miners who submitted nonces for the previous <config>";  _output << HISTORIC_BLOCK_COUNT; ;	_output << " blocks</config>.<br>\n"
		<< "					For the current block, a miner's share of the (<config>";  _output << CURRENT_BLOCK_REWARD_PERCENT; ;	_output << "%</config>) reward is inversely proportional to \n"
		<< "						<code>(deadline + 1)<span style=\"vertical-align: super\"><config>";  _output << SHARE_POWER_FACTOR; ;	_output << "</config></span></code>\n"
		<< "				</li>\n"
		<< "				<li>\n"
		<< "					Miner payouts are calculated after a minimum of <config>";  _output << MIN_PAYOUT_BLOCK_DELAY; ;	_output << " blocks</config> after the pool wins that block.<br>\n"
		<< "					Miner payouts are <b>D</b>eferred until their total pending payout is at least <config>";  _output << MINIMUM_PAYOUT / 100000000; ;	_output << " BURST</config>,\n"
		<< "						or the earliest pending payout is over <config>";  _output << MAX_PAYOUT_BLOCK_DELAY; ;	_output << " blocks</config> old.<br>\n"
		<< "					<b>Q</b>ueued payouts are waiting to be sent to the BURST network.<br>\n"
		<< "					<b>U</b>nconfirmed payouts have been sent to the BURST network but haven't had 10 confirmations yet.<br>\n"
		<< "					Confirmed payouts are listed as <b>P</b>aid.<br>\n"
		<< "					If there are no unconfirmed payouts, and no blocks won by the pool which haven't been shared out yet, then the balance, minus deferred payouts, is swept into the pool's fee account.\n"
		<< "				</li>  \n"
		<< "				<li>\n"
		<< "					Blago's miner config snippet:\n"
		<< "					<pre>\n"
		<< "						\"Mode\" : \"pool\",\n"
		<< "						\"Server\" : \"";  _output << POOL_HOSTNAME; ;	_output << "\",\n"
		<< "						\"Port\": ";  _output << LISTEN_PORT; ;	_output << ",\n"
		<< "						\n"
		<< "						\"UpdaterAddr\" : \"";  _output << POOL_HOSTNAME; ;	_output << "\",\n"
		<< "						\"UpdaterPort\": ";  _output << LISTEN_PORT; ;	_output << ",\n"
		<< "						\n"
		<< "						\"TargetDeadline\": ";  _output << DEADLINE_MAX; ;	_output << ",\n"
		<< "						\n"
		<< "						\"SendInterval\": 500,\n"
		<< "						\"UpdateInterval\": 1000,\n"
		<< "						\n"
		<< "						\"UseFastRcv\": false,\n"
		<< "					</pre>\n"
		<< "				</li>\n"
		<< "			</ul>\n"
		<< "		</div>\n"
		<< "	</div>\n"
		<< "</body>\n"
		<< "\n"
		<< "</html>"; 

	return _output.str();
};

